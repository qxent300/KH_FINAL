<?xml version="1.0" encoding="UTF-8"?>

<!-- Mapper 설정 파일임을 선언하는 부분 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.kh.finalproject.member.model.mapper.MyPageMapper">

	<resultMap type="Cart" id="cartResultMap">
		<id property="cNo" column="C_NO" />
		<result property="bNo" column="B_NO" />
		
		<result property="bName" column="B_NAME" />
		<result property="bWriter" column="B_WRITER" />
		<result property="bImage" column="B_IMAGE" />
		<result property="publishDate" column="PUBLISH_DATE" />
		
		<result property="uNo" column="U_NO" />
		
		<result property="uId" column="U_ID" />
		<result property="uName" column="U_NAME" />
		<result property="uAddress" column="U_ADDRESS" />
		<result property="uPhone" column="U_PHONE" />
	</resultMap>
	
	<resultMap type="Library" id="libraryResultMap">
		<id property="no" column="L_NO" />
		<result property="name" column="L_NAME" />
		<result property="address" column="L_ADDRESS" />
		<result property="lat" column="L_LAT" />
		<result property="lng" column="L_LNG" />
	</resultMap>
	
	<insert id="insertCart" parameterType="Cart">
		INSERT INTO CART VALUES(SEQ_C_NO.NEXTVAL, #{bNo}, #{uNo})
	</insert>
	
	<select id="selectAllCartList" resultMap="cartResultMap">
		SELECT C.C_NO, C.B_NO, B.B_NAME, B.B_WRITER, B.B_IMAGE, B.PUBLISH_DATE, C.U_NO, U.U_ID, U.U_NAME, U.U_ADDRESS, U.U_PHONE 
		FROM CART C, BOOK B, MEMBER U
		WHERE C.B_NO = B.B_NO AND C.U_NO = U.U_NO
	</select>
	
	<select id="selectLibraryList" parameterType="string" resultMap="libraryResultMap">
		SELECT * FROM LIBRARY WHERE L_ADDRESS LIKE '%'||#{address}||'%'
	</select>
	
	<insert id="insertRent" parameterType="Cart">
		INSERT INTO RENT VALUES(SEQ_RENT_NO.NEXTVAL, #{bNo}, #{uNo}, SYSDATE, SYSDATE + 7, '배송중')
	</insert>
	
	<select id="selectRentCount" resultType="int">
		SELECT COUNT(*) FROM RENT
	</select>

 </mapper>